<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>방송용 오버레이</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent; /* 주변 투명 */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #card {
      width: 640px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      padding: 16px;
      display: flex;
      align-items: center;
      opacity: 1 !important; /* 카드 자체는 불투명 */
      transition: background 0.3s ease;
    }

    #cover {
      width: 96px;
      height: 96px;
      border-radius: 12px;
      margin-right: 16px;
      object-fit: cover;
    }

    #info {
      flex: 1;
      color: #fff;
    }

    #title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 4px;
    }

    #meta {
      font-size: 14px;
      opacity: 0.85;
    }

    #visualizer {
      height: 40px;
      display: flex;
      align-items: flex-end;
      margin-left: 12px;
    }

    .bar {
      width: 4px;
      margin: 0 1px;
      background: white;
      animation: bounce 1s infinite ease-in-out;
    }

    @keyframes bounce {
      0%, 100% { height: 10px; }
      50% { height: 40px; }
    }
  </style>
</head>
<body>
  <div id="card">
    <img id="cover" src="" alt="Cover"/>
    <div id="info">
      <div id="title">불러오는 중...</div>
      <div id="meta">가수 / 제목</div>
    </div>
    <div id="visualizer"></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const apiUrl = params.get("api");

    async function fetchData() {
      if (!apiUrl) return;
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        // 데이터 반영
        document.getElementById("title").textContent = data.title || "제목 없음";
        document.getElementById("meta").textContent = (data.singer || "") + " / " + (data.source || "");
        document.getElementById("cover").src = data.coverUrl || "https://via.placeholder.com/96";

        // 카드 배경색 (컨트롤에서 설정한 값)
        if (data.style && data.style.cardColor) {
          document.getElementById("card").style.background = data.style.cardColor;
        } else {
          document.getElementById("card").style.background = "#666"; // 기본색
        }

      } catch (err) {
        document.getElementById("title").textContent = "불러오기 실패";
      }
    }

    // 시각화 바 생성
    const visualizer = document.getElementById("visualizer");
    for (let i = 0; i < 30; i++) {
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.animationDelay = `${i * 0.05}s`;
      visualizer.appendChild(bar);
    }

    // 주기적으로 데이터 새로고침
    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
