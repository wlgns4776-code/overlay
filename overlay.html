<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark light" />
<title>Overlay</title>
<style>
  /* ====== ì „ì²´ë¥¼ íˆ¬ëª…ìœ¼ë¡œ ====== */
  html, body {
    height: 100%;
    margin: 0;
    background: transparent;     /* â† ë°©ì†¡ ë¸Œë¼ìš°ì € ì†ŒìŠ¤ì—ì„œ ë°°ê²½ ì™„ì „ íˆ¬ëª… */
  }
  /* í˜ì´ì§€ì— ì—¬ë°± ì—†ì´ ì¹´ë“œë§Œ ë°°ì¹˜ */
  .root {
    position: relative;
    display: inline-block;
    /* ë°©ì†¡ ì†ŒìŠ¤ ì¢Œìƒë‹¨ì— ë”± ë¶™ê²Œ(ì›í•˜ë©´ transform ë“±ìœ¼ë¡œ ìœ„ì¹˜ì¡°ì • ê°€ëŠ¥) */
  }

  /* ====== ì¹´ë“œ ìŠ¤íƒ€ì¼ (640 ê³ ì •) ====== */
  :root{
    --card-w: 640px;
    --border: #2c3240;
    --panel: rgba(15,19,32,0.65);
    --radius: 20px;
    --pad: 16px;
    --shadow: 0 18px 40px rgba(0,0,0,.28);
  }
  .card{
    width: var(--card-w);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: var(--pad);
    background: var(--panel);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow: var(--shadow);
    color: #eaf0ff;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
  }

  .np{
    display: grid;
    gap: 16px;
    grid-template-columns: 180px 1fr;
    align-items: center;
  }
  .cover{
    width: 180px;
    aspect-ratio: 1/1;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: #1114;
  }
  .cover img{ width:100%; height:100%; object-fit:cover; display:block; }

  .title{
    font-weight: 800; font-size: 22px; line-height: 1.25;
    white-space: normal; word-break: keep-all; line-break: anywhere;
  }
  .meta{ opacity: .9; margin-top: 2px; font-size: 14px; }

  .ctrls{ display:flex; align-items:center; gap:12px; margin-top:10px; }
  .btn{ width:36px; height:36px; display:grid; place-items:center; border-radius: 999px;
        background:#0d1220; border:1px solid #273247; color:#eaf0ff; }
  .btn.primary{ width:46px; height:46px; background:#fff; color:#111; border:none; }

  /* íŒŒí˜• */
  .wave{ display:flex; gap:6px; align-items:flex-end; height:56px; margin-top:12px; }
  .bar{ width:6px; border-radius: 3px; background:#fff; opacity:.26; }
  .bar.active{ opacity:1; }
</style>
</head>
<body>
  <div class="root">
    <div class="card" id="card">
      <div class="np">
        <div class="cover">
          <!-- ê³ ì • ì»¤ë²„(ì €ì¥í•œ ì´ë¯¸ì§€ ê²½ë¡œ) -->
          <img id="cover" src="./assets/haming.png" alt="cover"/>
        </div>
        <div class="main">
          <div class="title" id="title">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
          <div class="meta" id="meta">SING ğŸ¤ ì„í•˜ë°</div>

          <div class="ctrls">
            <button class="btn" title="ì´ì „">â®</button>
            <button class="btn primary" title="ì¬ìƒ/ì¼ì‹œì •ì§€">â–¶</button>
            <button class="btn" title="ë‹¤ìŒ">â­</button>
          </div>

          <div class="wave" id="wave"></div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  /* ===== API íŒŒë¼ë¯¸í„° ì½ê¸° ===== */
  const qs = new URLSearchParams(location.search);
  const API = qs.get('api') || '';

  const $ = id => document.getElementById(id);
  const $title = $('title');
  const $meta  = $('meta');
  const $wave  = $('wave');

  /* íŒŒí˜• ìƒì„± */
  (function makeWave(){
    const bars = 40;
    const heights = Array.from({length: bars}, (_,i)=>
      16 + Math.round((Math.sin(i*1.2)*0.5+0.5)*40));
    const els = heights.map(h=>{
      const d = document.createElement('div');
      d.className = 'bar';
      d.style.height = h + 'px';
      $wave.appendChild(d);
      return d;
    });
    let idx = 0;
    setInterval(()=>{
      els.forEach((el,i)=> el.classList.toggle('active', i <= idx));
      idx = (idx + 1) % bars;
    }, 240);
  })();

  async function fetchJson(url){
    const res = await fetch(url, {cache:'no-store'});
    const ct  = res.headers.get('content-type')||'';
    if (ct.includes('application/json')) return res.json();
    const t = await res.text();
    try { return JSON.parse(t); } catch { return {}; }
  }

  async function tick(init){
    if (!API) return;
    try{
      const d = await fetchJson(API + '?nocache=' + Date.now());
      const singer = (d && d.singer) ? String(d.singer).trim() : '';
      const title  = (d && d.title ) ? String(d.title ).trim()  : '';
      $title.textContent = title || singer || 'ì²´í¬ëœ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤';
      $meta.textContent  = singer ? `${singer} / SING ğŸ¤ ì„í•˜ë°` : 'SING ğŸ¤ ì„í•˜ë°';
    }catch(e){
      if (init){
        $title.textContent = 'ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆì–´ìš”';
        $meta.textContent  = '';
      }
      console.error(e);
    }
  }

  tick(true);
  setInterval(tick, 2000);
})();
</script>
</body>
</html>
